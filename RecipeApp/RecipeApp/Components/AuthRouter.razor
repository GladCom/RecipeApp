@using Microsoft.AspNetCore.Components.Authorization
@rendermode InteractiveServer
@inject AuthService AuthService
@inject AuthenticationStateProvider AuthenticationStateProvider

<CascadingAuthenticationState>
    @if (isAuthenticated)
    {
        <Routes @rendermode="InteractiveServer" />
    }
    else
    {
        <LoginModal IsVisible="true" />
    }
</CascadingAuthenticationState>

@code {
    private bool isAuthenticated;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        isAuthenticated = authState.User.Identity?.IsAuthenticated ?? false;
        
        // Подписываемся на изменения состояния аутентификации
        (AuthenticationStateProvider as CustomAuthStateProvider)?.NotifyAuthenticationStateChanged();
    }
}